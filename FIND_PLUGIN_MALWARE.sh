#!/bin/bash

# FIND_PLUGIN_MALWARE.sh
# Detecta plugins suspeitos instalados no Roblox Studio (Mac)

echo "ğŸ” ==================== PLUGIN MALWARE DETECTOR ===================="
echo ""
echo "âš ï¸ Procurando por plugins maliciosos no Roblox Studio..."
echo ""

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Caminho dos plugins no Mac
PLUGINS_DIR="$HOME/Documents/Roblox/Plugins"

if [ ! -d "$PLUGINS_DIR" ]; then
    echo -e "${RED}âŒ DiretÃ³rio de plugins nÃ£o encontrado: $PLUGINS_DIR${NC}"
    echo "   VocÃª pode nÃ£o ter nenhum plugin instalado, ou o caminho estÃ¡ diferente."
    exit 1
fi

echo -e "${BLUE}ğŸ“‚ DiretÃ³rio de plugins: $PLUGINS_DIR${NC}"
echo ""

# Contar plugins
PLUGIN_COUNT=$(find "$PLUGINS_DIR" -type f \( -name "*.rbxm" -o -name "*.rbxmx" -o -name "*.lua" \) | wc -l | tr -d ' ')

if [ "$PLUGIN_COUNT" -eq 0 ]; then
    echo -e "${GREEN}âœ… Nenhum plugin encontrado! Isso Ã© bom - significa que nÃ£o hÃ¡ plugins instalados.${NC}"
    echo ""
    echo "Se o prompt de 55 robux ainda aparece, o malware pode estar em:"
    echo "1. Um free model inserido no jogo"
    echo "2. Um require() externo no cÃ³digo"
    echo "3. HttpService sendo usado para baixar scripts"
    exit 0
fi

echo -e "${YELLOW}âš ï¸ Encontrados $PLUGIN_COUNT plugin(s) instalado(s)${NC}"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Listar todos os plugins
echo "ğŸ“‹ LISTA DE PLUGINS INSTALADOS:"
echo ""

PLUGIN_NUM=1
find "$PLUGINS_DIR" -type f \( -name "*.rbxm" -o -name "*.rbxmx" -o -name "*.lua" \) -print0 | while IFS= read -r -d '' plugin; do
    filename=$(basename "$plugin")
    filesize=$(ls -lh "$plugin" | awk '{print $5}')
    modified=$(stat -f "%Sm" -t "%Y-%m-%d %H:%M" "$plugin")

    echo -e "${YELLOW}Plugin #$PLUGIN_NUM:${NC}"
    echo "   Nome: $filename"
    echo "   Tamanho: $filesize"
    echo "   Modificado: $modified"
    echo "   Caminho: $plugin"
    echo ""

    PLUGIN_NUM=$((PLUGIN_NUM + 1))
done

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo -e "${RED}ğŸš¨ AÃ‡ÃƒO NECESSÃRIA:${NC}"
echo ""
echo "1. Revise CADA plugin acima"
echo "2. Se vocÃª NÃƒO reconhece um plugin, DELETE-o:"
echo "   ${BLUE}rm \"caminho/do/plugin.rbxm\"${NC}"
echo ""
echo "3. Plugins suspeitos comuns:"
echo "   - Nomes genÃ©ricos: Plugin, Script, Model, Insert, etc"
echo "   - Relacionados a admin: HD Admin, Admin Panel, Owner Panel"
echo "   - Relacionados a free models: Free Models, Model Inserter"
echo "   - Nomes aleatÃ³rios ou estranhos"
echo ""
echo "4. Depois de deletar, REINICIE o Roblox Studio completamente"
echo "5. Abra o jogo e teste se o prompt ainda aparece"
echo ""
echo -e "${BLUE}ğŸ’¡ DICA: Se nÃ£o tem certeza sobre um plugin, DELETE. VocÃª pode reinstalar depois da Creator Store oficial.${NC}"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Para abrir a pasta de plugins no Finder:"
echo "  ${BLUE}open \"$PLUGINS_DIR\"${NC}"
echo ""
